import{_ as b,E as P,f as p,g as U,c as d,o as u,h as m,a as n,i as x,v as I,F as f,j as L,t as v,n as R,u as S}from"./app-BbnPs7Pj.js";function T(i=window.location.href){try{const a=new URL(i),s=`${a.protocol}//${a.host}`.length+1;let r=i.substring(s);const l=decodeURIComponent(r).replace(/\//g,"_");return l.length>5?l.substring(0,l.length-5):""}catch(a){return console.error("è§£æURLæˆ–å¤„ç†è·¯å¾„æ—¶å‡ºé”™:",a),""}}function j(i){return!i||i.code!==200||!Array.isArray(i.data)?[]:i.data.map(a=>{var c,s;return{id:a.commentId,postId:a.articlePath,author:((c=a.user)==null?void 0:c.username)||"åŒ¿åç”¨æˆ·",avatar:((s=a.user)==null?void 0:s.avatarUrl)||"https://via.placeholder.com/36",content:a.content,likes:a.likeCount??0,time:a.createdAt?a.createdAt.replace("T"," "):""}})}const A={class:"editor"},$=["disabled"],D={class:"editor-actions"},B={key:0,class:"comment-list"},G=["src"],M={class:"content"},V={class:"meta"},z={class:"author"},E={class:"time"},F={class:"text"},H={class:"actions"},N=["onClick"],O={__name:"Comment",setup(i){const{isDarkMode:a}=P(),c=p([]),s=p(""),r=p(null),h=p("");async function l(){if(h.value)try{const e=`http://localhost:8081/api/comments/article/${h.value}`,o=await(await fetch(e)).json();c.value=j(o)}catch(e){console.error("åŠ è½½è¯„è®ºå¤±è´¥",e)}}async function _(){if(!s.value.trim()){alert("è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºï¼");return}if(!r.value){alert("è¯·å…ˆç™»å½•åå†å‘è¡¨è¯„è®ºï¼");return}try{const e=r.value.githubid,o=await(await fetch("http://localhost:8081/api/comments",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({userId:e,articlePath:h.value,content:s.value}),credentials:"include"})).json();o.code===200?(s.value="",l()):alert(o.message||"æäº¤è¯„è®ºå¤±è´¥")}catch(e){console.error("æäº¤è¯„è®ºå¤±è´¥",e),alert("ç½‘ç»œé”™è¯¯ï¼Œæäº¤å¤±è´¥")}}async function g(e){if(!r.value){alert("è¯·å…ˆç™»å½•åå†ç‚¹èµï¼");return}try{const t=r.value.githubid,w=await(await fetch("http://localhost:8081/api/comment-likes",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({userId:t,commentId:e}),credentials:"include"})).json();w.error?alert(w.message||"ç‚¹èµå¤±è´¥"):l()}catch(t){console.error("ç‚¹èµå¤±è´¥",t),alert("ç½‘ç»œé”™è¯¯ï¼Œç‚¹èµå¤±è´¥")}}function y(){if(typeof window>"u")return;const t=`http://localhost:8081/oauth2/authorization/github?redirect_uri=${encodeURIComponent(window.location.href)}`;window.open(t,"_self")}function k(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search),t=e.get("error");t&&console.log("æˆæƒå¤±è´¥ï¼š",t,e.get("message"))}async function C(){try{const t=await(await fetch("http://localhost:8081/api/auth/me",{credentials:"include"})).json();r.value=t.error?null:t}catch(e){console.error("è·å–ç”¨æˆ·å¤±è´¥",e),r.value=null}}return U(()=>{typeof window<"u"&&(h.value=T(window.location.href),k(),l(),C())}),(e,t)=>(u(),d(f,null,[m(" è¯„è®ºæ•´ä½“å®¹å™¨ "),n("div",{class:R(["comment-section",{dark:S(a)}])},[t[2]||(t[2]=n("h3",null,"è¯„è®º",-1)),m(" è¾“å…¥æ¡†åŒºåŸŸ "),n("div",A,[x(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),class:"editor-input",placeholder:"ç™»å½•åå¯å‘è¡¨è¯„è®º...",disabled:!r.value},null,8,$),[[I,s.value]]),n("div",D,[m(" æœªç™»å½•æ—¶æ˜¾ç¤º GitHub ç™»å½•æŒ‰é’® "),r.value?(u(),d(f,{key:1},[m(" ç™»å½•åæ˜¾ç¤ºæäº¤æŒ‰é’® "),n("button",{class:"submit-btn",onClick:_}," æäº¤ ")],2112)):(u(),d("button",{key:0,class:"login-btn",onClick:y}," ä½¿ç”¨ GitHub ç™»å½• "))])]),m(" è¯„è®ºåˆ—è¡¨ "),c.value.length>0?(u(),d("div",B,[(u(!0),d(f,null,L(c.value,o=>(u(),d("div",{key:o.id,class:"comment-item"},[n("img",{src:o.avatar,alt:"avatar",class:"avatar"},null,8,G),n("div",M,[n("div",V,[n("span",z,v(o.author),1),n("span",E,v(o.time),1)]),n("p",F,v(o.content),1),n("div",H,[n("span",{class:"like",onClick:w=>g(o.id)},"ğŸ‘ "+v(o.likes),9,N)])])]))),128))])):(u(),d(f,{key:1},[m(" æ— è¯„è®ºæ—¶æç¤º "),t[1]||(t[1]=n("div",{class:"no-comment"},"æš‚æ— è¯„è®º",-1))],2112))],2)],2112))}},q=b(O,[["__scopeId","data-v-aa278402"]]);export{q as C};
