import{E as b,e as p,f as P,c as d,o as u,g as m,a as n,w as U,v as x,F as f,h as I,n as L,u as R,t as v}from"./app-ByNEC-t7.js";import{_ as S}from"./plugin-vue_export-helper-DlAUqK2U.js";function T(i=window.location.href){try{const o=new URL(i),s=`${o.protocol}//${o.host}`.length+1;let r=i.substring(s);const l=decodeURIComponent(r).replace(/\//g,"_");return l.length>5?l.substring(0,l.length-5):""}catch(o){return console.error("è§£æURLæˆ–å¤„ç†è·¯å¾„æ—¶å‡ºé”™:",o),""}}function A(i){return!i||i.code!==200||!Array.isArray(i.data)?[]:i.data.map(o=>{var c,s;return{id:o.commentId,postId:o.articlePath,author:((c=o.user)==null?void 0:c.username)||"åŒ¿åç”¨æˆ·",avatar:((s=o.user)==null?void 0:s.avatarUrl)||"https://via.placeholder.com/36",content:o.content,likes:o.likeCount??0,time:o.createdAt?o.createdAt.replace("T"," "):""}})}const $={class:"editor"},j=["disabled"],D={class:"editor-actions"},B={key:0,class:"comment-list"},G=["src"],M={class:"content"},V={class:"meta"},z={class:"author"},E={class:"time"},F={class:"text"},H={class:"actions"},N=["onClick"],O={__name:"Comment",setup(i){const{isDarkMode:o}=b(),c=p([]),s=p(""),r=p(null),h=p("");async function l(){if(h.value)try{const e=`http://localhost:8081/api/comments/article/${h.value}`,a=await(await fetch(e)).json();c.value=A(a)}catch(e){console.error("åŠ è½½è¯„è®ºå¤±è´¥",e)}}async function _(){if(!s.value.trim()){alert("è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºï¼");return}if(!r.value){alert("è¯·å…ˆç™»å½•åå†å‘è¡¨è¯„è®ºï¼");return}try{const e=r.value.githubid,a=await(await fetch("http://localhost:8081/api/comments",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({userId:e,articlePath:h.value,content:s.value}),credentials:"include"})).json();a.code===200?(s.value="",l()):alert(a.message||"æäº¤è¯„è®ºå¤±è´¥")}catch(e){console.error("æäº¤è¯„è®ºå¤±è´¥",e),alert("ç½‘ç»œé”™è¯¯ï¼Œæäº¤å¤±è´¥")}}async function g(e){if(!r.value){alert("è¯·å…ˆç™»å½•åå†ç‚¹èµï¼");return}try{const t=r.value.githubid,w=await(await fetch("http://localhost:8081/api/comment-likes",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({userId:t,commentId:e}),credentials:"include"})).json();w.error?alert(w.message||"ç‚¹èµå¤±è´¥"):l()}catch(t){console.error("ç‚¹èµå¤±è´¥",t),alert("ç½‘ç»œé”™è¯¯ï¼Œç‚¹èµå¤±è´¥")}}function y(){if(typeof window>"u")return;const t=`http://localhost:8081/oauth2/authorization/github?redirect_uri=${encodeURIComponent(window.location.href)}`;window.open(t,"_self")}function k(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search),t=e.get("error");t&&console.log("æˆæƒå¤±è´¥ï¼š",t,e.get("message"))}async function C(){try{const t=await(await fetch("http://localhost:8081/api/auth/me",{credentials:"include"})).json();r.value=t.error?null:t}catch(e){console.error("è·å–ç”¨æˆ·å¤±è´¥",e),r.value=null}}return P(()=>{typeof window<"u"&&(h.value=T(window.location.href),k(),l(),C())}),(e,t)=>(u(),d(f,null,[m(" è¯„è®ºæ•´ä½“å®¹å™¨ "),n("div",{class:L(["comment-section",{dark:R(o)}])},[t[2]||(t[2]=n("h3",null,"è¯„è®º",-1)),m(" è¾“å…¥æ¡†åŒºåŸŸ "),n("div",$,[U(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),class:"editor-input",placeholder:"ç™»å½•åå¯å‘è¡¨è¯„è®º...",disabled:!r.value},null,8,j),[[x,s.value]]),n("div",D,[m(" æœªç™»å½•æ—¶æ˜¾ç¤º GitHub ç™»å½•æŒ‰é’® "),r.value?(u(),d(f,{key:1},[m(" ç™»å½•åæ˜¾ç¤ºæäº¤æŒ‰é’® "),n("button",{class:"submit-btn",onClick:_}," æäº¤ ")],2112)):(u(),d("button",{key:0,class:"login-btn",onClick:y}," ä½¿ç”¨ GitHub ç™»å½• "))])]),m(" è¯„è®ºåˆ—è¡¨ "),c.value.length>0?(u(),d("div",B,[(u(!0),d(f,null,I(c.value,a=>(u(),d("div",{key:a.id,class:"comment-item"},[n("img",{src:a.avatar,alt:"avatar",class:"avatar"},null,8,G),n("div",M,[n("div",V,[n("span",z,v(a.author),1),n("span",E,v(a.time),1)]),n("p",F,v(a.content),1),n("div",H,[n("span",{class:"like",onClick:w=>g(a.id)},"ğŸ‘ "+v(a.likes),9,N)])])]))),128))])):(u(),d(f,{key:1},[m(" æ— è¯„è®ºæ—¶æç¤º "),t[1]||(t[1]=n("div",{class:"no-comment"},"æš‚æ— è¯„è®º",-1))],2112))],2)],2112))}},K=S(O,[["__scopeId","data-v-9fea7d25"]]);export{K as C};
