---
icon: pen-to-square
date: 2025-12-04
# order: 1
category:
  - 数学
tag:
  - 随笔
  - 假设检验
  - 参数检验
---

# 方差分析（ANOVA）

## 一、什么是方差分析？

方差分析（Analysis of Variance, **ANOVA**）用于检验多个总体均值是否相等。

其核心思想是比较：

- **组间变异**（不同组均值之间的差异，解释为“因素效应”）
- **组内变异**（组内个体间的随机差异，即“误差”）

记第 $i$ 组第 $j$ 个观测值为 **$Y_{ij}$**，方差分析要判断：

> 不同组的平均值 $\,\mu_i\,$（总体均值）是否都相同？

---

## 二、为什么用方差分析？

当组数 ≥ 3，若用多次 t 检验，会导致：

- 错误率显著上升  
- 推断不再可靠  

ANOVA 提供“一次整体检验”来判断：

> $H_0:\ \mu_1 = \mu_2 = \cdots = \mu_k$

是否成立。

其中 $k$ 表示组数（因素水平数）。

---

## 三、一元方差分析（One-way ANOVA）模型

模型写为：

$$
Y_{ij} = \mu + \alpha_i + \varepsilon_{ij}
$$

其中：

- $\mu$：总体均值（基准平均水平）  
- $\alpha_i$：因素第 $i$ 水平的效应（组均值相对 $\mu$ 的偏移）  
- $\varepsilon_{ij}$：随机误差项（独立、均值 0、方差 $\sigma^2$）

第 $i$ 组样本均值记为 **$\bar X_i$**，所有样本的总体平均记为 **$\bar X$**。

---

## 四、方差分解（ANOVA 核心思想）

总变异可以拆分为：

$$
SS_T = SS_B + SS_W
$$

其中：

- **$SS_T$（Total Sum of Squares）总平方和**  
  衡量所有数据偏离总体均值 $\bar X$ 的程度。

- **$SS_B$（Between Groups）组间平方和**  
  衡量各组均值 $\bar X_i$ 相对总体均值的差异，用来度量“因素效应”。

  $$ SS_B = \sum_{i=1}^k n_i(\bar X_i - \bar X)^2 $$

  其中 $n_i$ 为第 $i$ 组的样本量。

- **$SS_W$（Within Groups）组内平方和**  
  衡量每组内的随机误差：

  $$
  SS_W = \sum_{i=1}^k\sum_{j=1}^{n_i}(Y_{ij}-\bar X_i)^2
  $$

---

## 五、自由度（df）与均方（MS）

自由度：

- **组间自由度**：$df_B = k - 1$  
- **组内自由度**：$df_W = N - k$  
- **总自由度**：$df_T = N - 1$

其中 $N$ 为总样本量，$N = \sum n_i$，$k$为组数。

均方（Mean Square）是平方和除以自由度：

$$
MS_B = \frac{SS_B}{df_B},\qquad MS_W = \frac{SS_W}{df_W}
$$

---

## 六、F 统计量与 p 值

F 值定义为：

$$
F = \frac{MS_B}{MS_W}
$$

含义：

- 若组间变异 ($MS_B$) 远大于组内变异 ($MS_W$)  
  → $F$ 大  
  → 说明因素效应显著。

p 值定义为在 $H_0$（均值相等）成立下：

$$
p = P(F_{(df_B,df_W)} \ge F_{\text{obs}})
$$

若 $p < \alpha$（通常 $\alpha=0.05$）则拒绝 $H_0$。

---

## 七、单因素方差分析流程总结

1. 计算组均值 $\bar X_i$ 与总体均值 $\bar X$  
2. 计算 $SS_B, SS_W, SS_T$  
3. 分配自由度：$k-1$, $N-k$, $N-1$  
4. 计算均方 $MS_B$, $MS_W$  
5. 计算 F 值  
6. 计算 p 值  
7. 判断是否拒绝原假设  

---

## 八、单因素方差分析实例（完整手算）

数据（三种教学方法）：

- A：8, 9, 6, 7  
- B：5, 4, 6, 5  
- C：9, 10, 8, 9  

每组 $n=4$，组数 $k=3$，总样本 $N=12$。

---

### 1. 组均值与总体均值

$$
\bar X_A=7.5,\quad \bar X_B=5.0,\quad \bar X_C=9.0
$$

总体均值：

$$
\bar X=\frac{86}{12}=7.17
$$

---

### 2. 计算平方和

#### (1) 组间平方和 $SS_B$

$$
SS_B\approx4(0.33^2)+4(2.17^2)+4(1.83^2)=32.67
$$

#### (2) 组内平方和 $SS_W$

由于每组与各自均值偏差平方和分别为：

- A：5  
- B：2  
- C：2  

故：

$$
SS_W = 5 + 2 + 2 = 9
$$

#### (3) 总平方和

$$
SS_T = SS_B + SS_W = 32.67 + 9 = 41.67
$$

---

### 3. 自由度

- $df_B = k-1 = 2$  
- $df_W = N-k = 9$  
- $df_T = 11$

---

### 4. 均方

$$
MS_B=\frac{32.67}{2}=16.33
$$

$$
MS_W=\frac{9}{9}=1.00
$$

---

### 5. F 值

$$
F=\frac{16.33}{1.00}=16.33
$$

---

### 6. p 值

通过 F 分布：

$$
p=P(F_{(2,9)}\ge16.33)\approx0.001
$$

---

### 7. ANOVA 表

| Source         | SS    | df   | MS    | F     | p     |
| -------------- | ----- | ---- | ----- | ----- | ----- |
| Between Groups | 32.67 | 2    | 16.33 | 16.33 | 0.001 |
| Within Groups  | 9.00  | 9    | 1.00  | —     | —     |
| Total          | 41.67 | 11   | —     | —     | —     |

**结论：教学方法对成绩的影响显著。**

---

## 九、双因素、三因素方差分析（扩展简介）

---

### 1. 双因素方差分析（Two-way ANOVA）

当存在两个因素（如肥料 A、灌溉 B）时，模型可检验：

- A 的主效应  
- B 的主效应  
- A×B 的交互效应（因素之间是否互相影响）

方差分解：

$$
SS_T = SS_A + SS_B + SS_{AB} + SS_E
$$

其中：

- $SS_A$：因素 A 对均值差异的解释部分  
- $SS_B$：因素 B 的效应  
- $SS_{AB}$：交互作用的效应  
- $SS_E$：误差平方和  

---

### 2. 三因素方差分析（Three-way ANOVA）

当有三个因素（如温度 A、压力 B、催化剂 C）时，可检验：

- A、B、C 三个主效应  
- 三个二阶交互：A×B、A×C、B×C  
- 一个三阶交互：A×B×C  

方差分解：

$$
SS_T = SS_A + SS_B + SS_C + SS_{AB} + SS_{AC} + SS_{BC} + SS_{ABC} + SS_E
$$

每一部分都有自己的自由度、均方和 F 检验。

---

## 十、总结

方差分析核心逻辑：

1. **将总方差拆分为组间（因素效应）+ 组内（误差）**
2. **计算 $F = MS_B / MS_W$，比较信号与噪声**
3. **p 值来自 F 分布右尾概率**
4. **显著则拒绝均值相等的原假设**

扩展形式（双因素、三因素）仅是在同一框架下增加主效应与交互效应的分解。